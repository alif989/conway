<html>
      <head>
        <meta charset="UTF-8">
        <title>README.md</title>
      </head>
      <body>
        <h1 id="corcel">Corcel</h1>
<blockquote>
<p>This package allows you to use WordPress as backend (admin panel) and retrieve its data using Eloquent, with any PHP project or even framework.</p>
</blockquote>
<p><a href="https://travis-ci.org/corcel/corcel?branch=dev"><img src="https://travis-ci.org/corcel/corcel.svg?branch=dev" alt="Travis"></a>
<a href="https://packagist.org/packages/jgrossi/corcel"><img src="https://img.shields.io/packagist/v/jgrossi/corcel.svg" alt="Packagist"></a>
<a href="https://github.com/jgrossi/corcel/releases"><img src="https://img.shields.io/packagist/dt/jgrossi/corcel.svg" alt="Packagist"></a></p>
<p><a href='https://ko-fi.com/A36513JF' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://az743702.vo.msecnd.net/cdn/kofi4.png?v=0' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a></p>
<p><a href="http://twitter.com/CorcelPHP"><img src="https://img.shields.io/twitter/follow/corcelphp.svg?style=social&amp;label=Follow" alt="Twitter Follow"></a></p>
<p>Corcel is a class collection created to retrieve WordPress database data using a better syntax. It uses the <a href="https://github.com/illuminate/database">Eloquent ORM</a> developed for the Laravel Framework, but you can use Corcel in any type of PHP project, with any framework, including Laravel.</p>
<p>This way, you can use WordPress as the backend (admin panel), to insert posts, custom types, etc, and you can use whatever you want in the frontend, like Silex, Slim Framework, Laravel, Zend, or even pure PHP (why not?). So, just use Corcel to retrieve data from WordPress.</p>
<h1 id="contents">Contents</h1>
<ul>
<li><a href="#install">Installing Corcel</a></li>
<li><a href="#database-setup">Database Setup</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#posts">Posts</a></li>
<li><a href="#acf">Advanced Custom Fields (ACF) Integration</a></li>
<li><a href="#custom-post">Custom Post Type</a></li>
<li><a href="#single-tab">Single Table Inheritance</a></li>
<li><a href="#taxonomies">Taxonomies</a></li>
<li><a href="#post-format">Post Format</a></li>
<li><a href="#pages">Pages</a></li>
<li><a href="#cats">Categories &amp; Taxonomies</a></li>
<li><a href="#attachments">Attachments &amp; Revision</a></li>
<li><a href="#menu">Menu</a></li>
<li><a href="#users">Users</a></li>
<li><a href="#auth">Authentication</a></li>
<li><a href="#tests">Running Tests</a></li>
</ul>
</li>
<li><a href="#contrib">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1 id="-a-id-install-a-installing-corcel"><a id="install"></a> Installing Corcel</h1>
<p>You need to use Composer to install Corcel into your project:</p>
<pre><code>composer require jgrossi/corcel
</code></pre><p>Now you&#39;re almost ready to use Corcel classes, like <code>Corcel\Post</code>.</p>
<h2 id="wordpress-installation">WordPress Installation</h2>
<p>You can install WordPress inside Laravel&#39;s <code>/public</code> directory, like <code>/public/wordpress</code>, for example, or even in a different domain or server. You only have to enable access to its database, because that&#39;s what Corcel will use. This is made by creating a database connection.</p>
<h1 id="-a-id-database-setup-a-database-setup"><a id="database-setup"></a> Database Setup</h1>
<h2 id="laravel-setup">Laravel Setup</h2>
<p>Corcel by default will look for a <code>wordpress</code> or <code>corcel</code> database connection in your Laravel <code>config/database.php</code> file. If it does not find any of these connections it&#39;ll use the <code>default</code> connection.</p>
<p>For example, you can have a <code>default</code> connection for your Laravel app tables and models, and another one called <code>wordpress</code> or <code>corcel</code> for your WordPress tables. Easy like that.</p>
<pre><code class="lang-php">&lt;?php // File: /config/database.php

&#39;connections&#39; =&gt; [

    &#39;mysql&#39; =&gt; [ // for Laravel database
        &#39;driver&#39;    =&gt; &#39;mysql&#39;,
        &#39;host&#39;      =&gt; &#39;localhost&#39;,
        &#39;database&#39;  =&gt; &#39;mydatabase&#39;,
        &#39;username&#39;  =&gt; &#39;admin&#39;
        &#39;password&#39;  =&gt; &#39;secret&#39;,
        &#39;charset&#39;   =&gt; &#39;utf8&#39;,
        &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
        &#39;prefix&#39;    =&gt; &#39;&#39;,
        &#39;strict&#39;    =&gt; false,
        &#39;engine&#39;    =&gt; null,
    ],

    &#39;wordpress&#39; =&gt; [ // for WordPress database
        &#39;driver&#39;    =&gt; &#39;mysql&#39;,
        &#39;host&#39;      =&gt; &#39;localhost&#39;,
        &#39;database&#39;  =&gt; &#39;mydatabase&#39;,
        &#39;username&#39;  =&gt; &#39;admin&#39;,
        &#39;password&#39;  =&gt; &#39;secret&#39;,
        &#39;charset&#39;   =&gt; &#39;utf8&#39;,
        &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
        &#39;prefix&#39;    =&gt; &#39;wp_&#39;,
        &#39;strict&#39;    =&gt; false,
        &#39;engine&#39;    =&gt; null,
    ],
],
</code></pre>
<h2 id="other-php-framework-not-laravel-setup">Other PHP Framework (not Laravel) Setup</h2>
<p>Here you have to configure the database to fit the Corcel requirements. First, you should include the Composer <code>autoload</code> file if not already loaded:</p>
<pre><code class="lang-php">require __DIR__ . &#39;/vendor/autoload.php&#39;;
</code></pre>
<p>Now you must set your WordPress database params:</p>
<pre><code class="lang-php">$params = array(
    &#39;database&#39;  =&gt; &#39;database_name&#39;,
    &#39;username&#39;  =&gt; &#39;username&#39;,
    &#39;password&#39;  =&gt; &#39;pa$$word&#39;,
    &#39;prefix&#39;    =&gt; &#39;wp_&#39; // default prefix is &#39;wp_&#39;, you can change to your own prefix
);
Corcel\Database::connect($params);
</code></pre>
<p>You can specify all Eloquent params, but some are default (but you can override them).</p>
<pre><code class="lang-php">&#39;driver&#39;    =&gt; &#39;mysql&#39;,
&#39;host&#39;      =&gt; &#39;localhost&#39;,
&#39;charset&#39;   =&gt; &#39;utf8&#39;,
&#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
&#39;prefix&#39;    =&gt; &#39;wp_&#39;, // Specify the prefix for WordPress tables, default prefix is &#39;wp_&#39;
</code></pre>
<h1 id="-a-id-usage-a-usage"><a id="usage"></a>  Usage</h1>
<p>Optionally you can create your own <code>Post</code> model which extends <code>Corcel\Post</code>. Then set the connection name you&#39;re using, in this case <code>foo-bar</code>:</p>
<pre><code class="lang-php">&lt;?php // File: app/Post.php

namespace App;

use Corcel\Post as Corcel;

class Post extends Corcel
{
    protected $connection = &#39;foo-bar&#39;;
}
</code></pre>
<p>So, now you can fetch WP database data using your own class:</p>
<pre><code class="lang-php">$posts = App\Post::all(); // using the &#39;foo-bar&#39; connection
</code></pre>
<blockquote>
<p>Remembering that if you have a <code>wordpress</code> or <code>corcel</code> database connection you don&#39;t need to extend <code>Corcel\Post</code> class, just use <code>Corcel\Post</code> instead.</p>
</blockquote>
<h2 id="-a-id-posts-a-posts"><a id="posts"></a> Posts</h2>
<blockquote>
<p>Every time you see <code>Post::method()</code>, if you&#39;re using your own Post class (where you set the connection name), like <code>App\Post</code> you should use <code>App\Post::method()</code> and not <code>Post::method()</code>. All the examples are assuming you already know this difference.</p>
</blockquote>
<pre><code class="lang-php">// All published posts
$posts = Post::published()-&gt;get();
$posts = Post::status(&#39;publish&#39;)-&gt;get();

// A specific post
$post = Post::find(31);
echo $post-&gt;post_title;

// Filter by meta/custom field
$posts = Post::published()-&gt;hasMeta(&#39;field&#39;)-&gt;get();
$posts = Post::hasMeta(&#39;acf&#39;)-&gt;get();
</code></pre>
<p>You can retrieve meta data from posts too.</p>
<pre><code class="lang-php">// Get a custom meta value (like &#39;link&#39; or whatever) from a post (any type)
$post = Post::find(31);
echo $post-&gt;meta-&gt;link; // OR
echo $post-&gt;fields-&gt;link;
echo $post-&gt;link; // OR
</code></pre>
<p>Updating post custom fields:</p>
<pre><code class="lang-php">$post = Post::find(1);
$post-&gt;meta-&gt;username = &#39;juniorgrossi&#39;;
$post-&gt;meta-&gt;url = &#39;http://grossi.io&#39;;
$post-&gt;save();
</code></pre>
<p>Inserting custom fields:</p>
<pre><code class="lang-php">$post = new Post;
$post-&gt;save();

$post-&gt;meta-&gt;username = &#39;juniorgrossi&#39;;
$post-&gt;meta-&gt;url = &#39;http://grossi.io&#39;;
$post-&gt;save();
</code></pre>
<h2 id="-a-id-acf-a-advanced-custom-fields-acf-"><a id="acf"></a>  Advanced Custom Fields (ACF)</h2>
<p>If you want to retrieve a custom field created by the <a href="http://advancedcustomfields.com">Advanced Custom Fields (ACF)</a> plugin, you have to install the <a href="http://github.com/corcel/acf"><code>corcel/acf</code></a> plugin and call the custom field like this:</p>
<pre><code class="lang-php">$post = Post::find(123);
echo $post-&gt;acf-&gt;some_radio_field;
$repeaterFields = $post-&gt;acf-&gt;my_repeater_name;
</code></pre>
<p>To avoid unnecessary SQL queries just set the field type you&#39;re requesting. Usually two SQL queries are necessary to get the field type, so if you want to specify it you&#39;re skipping those extra queries:</p>
<pre><code class="lang-php">$post = Post::find(123);
echo $post-&gt;acf-&gt;text(&#39;text_field_name&#39;);
echo $post-&gt;acf-&gt;boolean(&#39;boolean_field_name&#39;);
</code></pre>
<h2 id="-a-id-custom-post-a-custom-post-type"><a id="custom-post"></a> Custom Post Type</h2>
<p>You can work with custom post types too. You can use the <code>type(string)</code> method or create your own class.</p>
<pre><code class="lang-php">// using type() method
$videos = Post::type(&#39;video&#39;)-&gt;status(&#39;publish&#39;)-&gt;get();

// using your own class
class Video extends Corcel\Post
{
    protected $postType = &#39;video&#39;;
}
$videos = Video::status(&#39;publish&#39;)-&gt;get();
</code></pre>
<p>Using <code>type()</code> method will make Corcel to return all objects as <code>Corcel\Post</code>. Using your custom class you have the advantage to customize classes, including custom methods and properties, return all objects as <code>Video</code>, for example.</p>
<p>Custom post types and meta data:</p>
<pre><code class="lang-php">// Get 3 posts with custom post type (store) and show its address
$stores = Post::type(&#39;store&#39;)-&gt;status(&#39;publish&#39;)-&gt;take(3)-&gt;get();
foreach ($stores as $store) {
    $storeAddress = $store-&gt;address; // option 1
    $storeAddress = $store-&gt;meta-&gt;address; // option 2
    $storeAddress = $store-&gt;fields-&gt;address; // option 3
}
</code></pre>
<h2 id="-a-id-single-tab-a-single-table-inheritance"><a id="single-tab"></a>Single Table Inheritance</h2>
<p>If you choose to create a new class for your custom post type, you can have this class be returned for all instances of that post type.</p>
<pre><code class="lang-php">//all objects in the $videos Collection will be instances of Post
$videos = Post::type(&#39;video&#39;)-&gt;status(&#39;publish&#39;)-&gt;get();

// register the video custom post type and its particular class
Post::registerPostType(&#39;video&#39;, &#39;\App\Video&#39;)


//now all objects in the $videos Collection will be instances of Video
$videos = Post::type(&#39;video&#39;)-&gt;status(&#39;publish&#39;)-&gt;get();
</code></pre>
<p>You can also do this for inbuilt classes, such as Page or Post. Simply register the Page or Post class with the associated post type string, and that object will be returned instead of the default one.</p>
<p>This is particular useful when you are intending to get a Collection of Posts of different types (e.g. when fetching the posts defined in a menu).</p>
<h2 id="-a-id-shortcodes-a-shortcodes"><a id="shortcodes"></a> Shortcodes</h2>
<p>You can add <a href="https://codex.wordpress.org/Shortcode_API">shortcodes</a> by calling the <code>addShortcode</code> method on the <code>Post</code> model :</p>
<pre><code class="lang-php">// [gallery id=&quot;1&quot;]
Post::addShortcode(&#39;gallery&#39;, function ($shortcode) {
    return $shortcode-&gt;getName() . &#39;.&#39; . $shortcode-&gt;getParameter(&#39;id&#39;);
});
$post = Post::find(1);
echo $post-&gt;content;
</code></pre>
<p>If you are using Laravel, we suggest adding your shortcodes handlers in <code>App\Providers\AppServiceProvider</code>, in the <code>boot</code> method.</p>
<p>The <a href="https://github.com/thunderer/Shortcode"><em>thunderer/shortcode</em></a> library is used to parse the shortcodes.  For more information, <a href="https://github.com/thunderer/Shortcode">click here</a>.</p>
<h2 id="-a-id-taxonomies-a-taxonomies"><a id="taxonomies"></a>Taxonomies</h2>
<p>You can get taxonomies for a specific post like:</p>
<pre><code class="lang-php">$post = Post::find(1);
$taxonomy = $post-&gt;taxonomies()-&gt;first();
echo $taxonomy-&gt;taxonomy;
</code></pre>
<p>Or you can search for posts using its taxonomies:</p>
<pre><code class="lang-php">$post = Post::taxonomy(&#39;category&#39;, &#39;php&#39;)-&gt;first();
</code></pre>
<h2 id="-a-id-post-format-a-post-format"><a id="post-format"></a>Post Format</h2>
<p>You can also get the post format, like the WordPress function <code>get_post_format()</code>:</p>
<pre><code class="lang-php">echo $post-&gt;getFormat(); // should return something like &#39;video&#39;, etc
</code></pre>
<h2 id="-a-id-pages-a-pages"><a id="pages"></a>Pages</h2>
<p>Pages are like custom post types. You can use <code>Post::type(&#39;page&#39;)</code> or the <code>Corcel\Page</code> class.</p>
<pre><code class="lang-php">
use Corcel\Page;

// Find a page by slug
$page = Page::slug(&#39;about&#39;)-&gt;first(); // OR
$page = Post::type(&#39;page&#39;)-&gt;slug(&#39;about&#39;)-&gt;first();
echo $page-&gt;post_title;
</code></pre>
<h2 id="-a-id-cats-a-categories-taxonomies"><a id="cats"></a>Categories &amp; Taxonomies</h2>
<p>Get a category or taxonomy or load posts from a certain category. There are multiple ways
to achieve it.</p>
<pre><code class="lang-php">// all categories
$cat = Taxonomy::category()-&gt;slug(&#39;uncategorized&#39;)-&gt;posts()-&gt;first();
echo &quot;&lt;pre&gt;&quot;; print_r($cat-&gt;name); echo &quot;&lt;/pre&gt;&quot;;

// only all categories and posts connected with it
$cat = Taxonomy::where(&#39;taxonomy&#39;, &#39;category&#39;)-&gt;with(&#39;posts&#39;)-&gt;get();
$cat-&gt;each(function($category) {
    echo $category-&gt;name;
});

// clean and simple all posts from a category
$cat = Category::slug(&#39;uncategorized&#39;)-&gt;posts()-&gt;first();
$cat-&gt;posts-&gt;each(function($post) {
    echo $post-&gt;post_title;
});
</code></pre>
<h2 id="-a-id-attachments-a-attachment-and-revision"><a id="attachments"></a>Attachment and Revision</h2>
<p>Getting the attachment and/or revision from a <code>Post</code> or <code>Page</code>.</p>
<pre><code class="lang-php">$page = Page::slug(&#39;about&#39;)-&gt;with(&#39;attachment&#39;)-&gt;first();
// get feature image from page or post
print_r($page-&gt;attachment);

$post = Post::slug(&#39;test&#39;)-&gt;with(&#39;revision&#39;)-&gt;first();
// get all revisions from a post or page
print_r($post-&gt;revision);
</code></pre>
<h2 id="-a-id-menu-a-menu"><a id="menu"></a> Menu</h2>
<p>To get a menu by its slug, use the syntax below.
The menu items will be loaded in the <code>nav_items</code> variable. The currently supported menu items are: Pages, Posts, Links, Categories, Tags.</p>
<pre><code class="lang-php">$menu = Menu::slug(&#39;primary&#39;)-&gt;first();

foreach ($menu-&gt;nav_items as $item) {
    // ....
    &#39;post_title&#39;    =&gt; &#39;....&#39;, // Nav item name
    &#39;post_name&#39;     =&gt; &#39;....&#39;, // Nav item slug
    &#39;guid&#39;          =&gt; &#39;....&#39;, // Nav full url, influent by permalinks
    // ....
}
</code></pre>
<p>To handle multi-levels menus, loop through all the menu items to put them on the right levels in an array.
Then, you can walk through the items recursively.</p>
<p>Here&#39;s just a basic example:</p>
<pre><code class="lang-php">// first, set all menu items on their level
$menuArray = array();
foreach ($menu-&gt;nav_items as $item) {
    $parent_id = $item-&gt;meta-&gt;_menu_item_menu_item_parent;
    $menuArray[$parent_id][] = $item;
}

// now build the menu
foreach ($menuArray[0] as $item) {
    echo &#39;.. menu item main ..&#39;;
    if (isset($menuArray[$item-&gt;ID])) {
        foreach($menuArray[$item-&gt;ID] as $subItem) {
            echo &#39;.. show sub menu item ..&#39;;
        }
    }
}
</code></pre>
<h2 id="-a-id-users-a-users"><a id="users"></a> Users</h2>
<p>You can manipulate users in the same manner you work with posts:</p>
<pre><code class="lang-php">// All users
$users = User::get();

// A specific user
$user = User::find(1);
echo $user-&gt;user_login;
</code></pre>
<h2 id="-a-id-auth-a-authentication"><a id="auth"></a>Authentication</h2>
<h3 id="using-laravel">Using laravel</h3>
<p>You will have to register Corcel&#39;s authentication service provider in <code>config/app.php</code> :</p>
<pre><code class="lang-php">&#39;providers&#39; =&gt; [
    // Other Service Providers

    Corcel\Providers\Laravel\AuthServiceProvider::class,
],
</code></pre>
<p>And then, define the user provider in <code>config/auth.php</code> :</p>
<pre><code class="lang-php">&#39;providers&#39; =&gt; [
    &#39;users&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;corcel&#39;,
        &#39;model&#39;  =&gt; Corcel\User::class,
    ],
],
</code></pre>
<p>To make Laravel&#39;s Password Reset work with Corcel, we have to override how passwords are stored in the database. To do this, you must change <code>Auth/PasswordController.php</code> from :</p>
<pre><code class="lang-php">use App\Http\Controllers\Controller;
use Illuminate\Foundation\Auth\ResetsPasswords;

class PasswordController extends Controller
{
    use ResetsPasswords;
</code></pre>
<p>to</p>
<pre><code class="lang-php">use App\Http\Controllers\Controller;
use Illuminate\Foundation\Auth\ResetsPasswords;
use Corcel\Auth\ResetsPasswords as CorcelResetsPasswords;

class PasswordController extends Controller
{
    use ResetsPasswords, CorcelResetsPasswords {
        CorcelResetsPasswords::resetPassword insteadof ResetsPasswords;
    }
</code></pre>
<h3 id="using-something-else">Using something else</h3>
<p>You can use the <code>AuthUserProvider</code> class to authenticate an user :</p>
<pre><code class="lang-php">$userProvider = new Corcel\Providers\AuthUserProvider;
$user = $userProvider-&gt;retrieveByCredentials([&#39;username&#39; =&gt; &#39;admin&#39;]);
if(!is_null($user) &amp;&amp; $userProvider-&gt;validateCredentials($user, [&#39;password&#39; =&gt; &#39;admin&#39;])) {
    // successfully login
}
</code></pre>
<h1 id="-a-id-tests-a-running-tests"><a id="tests"></a> Running Tests</h1>
<p>To run the phpunit tests, execute the following command :</p>
<pre><code>./vendor/bin/phpunit
</code></pre><p>If you have the global <code>phpunit</code> command installed you can just type:</p>
<pre><code>phpunit
</code></pre><h1 id="-a-id-contrib-a-contributing"><a id="contrib"></a> Contributing</h1>
<p>All contributions are welcome to help improve Corcel.</p>
<p>Before you submit your pull request consider the following guidelines:</p>
<ul>
<li>Make your changes in a new git branch, based on the dev branch:</li>
</ul>
<p><code>git checkout -b my-fix-branch dev</code></p>
<ul>
<li><p>Create your patch/feature, including appropriate test cases.</p>
</li>
<li><p>Run the unit tests, and ensure that all tests pass.</p>
</li>
<li><p>In GitHub, send a pull request to <code>corcel:dev</code>, not <code>corcel:master</code>, please.</p>
</li>
</ul>
<h2 id="-a-id-license-a-licence"><a id="license"></a> Licence</h2>
<p><a href="http://jgrossi.mit-license.org/">MIT License</a> © Junior Grossi</p>

      </body>
    </html>